<PlotlyChart @bind-Config="config" @bind-Layout="layout" @bind-Data="data" @ref="chart" />

@code {

	[Parameter]
	public List<object> XValuesLine { get; set; }

	[Parameter]
	public List<object> YValuesLine { get; set; }

	[Parameter]
	public List<object> ZValuesLine { get; set; }

	[Parameter]
	public string ValuesNameLine { get; set; }
	[Parameter]
	public List<object> XValuesLine2 { get; set; }

	[Parameter]
	public List<object> YValuesLine2 { get; set; }

	[Parameter]
	public List<object> ZValuesLine2 { get; set; }

	[Parameter]
	public string ValuesNameLine2 { get; set; }

	[Parameter]
	public List<object> XValues { get; set; }

	[Parameter]
	public List<object> YValues { get; set; }

	[Parameter]
	public List<object> ZValues { get; set; }

	[Parameter]
	public string ValuesName { get; set; }



	[Parameter]
	public List<object> XValues2 { get; set; }

	[Parameter]
	public List<object> YValues2 { get; set; }

	[Parameter]
	public List<object> ZValues2 { get; set; }

	[Parameter]
	public string ValuesName2 { get; set; }

	[Parameter]
	public List<List<object>> XValuesList { get; set; }

	[Parameter]
	public List<List<object>> YValuesList { get; set; }

	[Parameter]
	public List<List<object>> ZValuesList { get; set; }

	[Parameter]
	public string ValuesListColor { get; set; }

	[Parameter]
	public string ValuesNameList { get; set; }
	[Parameter]
	public List<List<object>> XValuesList2 { get; set; }

	[Parameter]
	public List<List<object>> YValuesList2 { get; set; }

	[Parameter]
	public List<List<object>> ZValuesList2 { get; set; }

	[Parameter]
	public string ValuesListColor2 { get; set; }

	[Parameter]
	public string ValuesNameList2 { get; set; }

	[Parameter]
	public List<List<object>> XValuesCompare { get; set; }

	[Parameter]
	public List<List<object>> YValuesCompare { get; set; }

	[Parameter]
	public List<List<object>> ZValuesCompare { get; set; }

	[Parameter]
	public List<List<List<object>>> XValuesListCompare { get; set; }

	[Parameter]
	public List<List<List<object>>> YValuesListCompare { get; set; }

	[Parameter]
	public List<List<List<object>>> ZValuesListCompare { get; set; }

	[Parameter]
	public List<string> ValuesListColorCompare { get; set; }

	[Parameter]
	public string ValuesNameListCompare { get; set; }
	[Parameter]
	public int PlotHeight { get; set; }

	[Parameter]
	public int PlotWidth { get; set; }

	[Parameter]
	public string PlotTitle { get; set; }

	[Parameter]
	public string XAxisTitle { get; set; }

	[Parameter]
	public string YAxisTitle { get; set; }

	[Parameter]
	public string ZAxisTitle { get; set; }

	[Parameter]
	public bool ZAxisIsReversed { get; set; }

	private PlotlyChart chart;
	private Config config = new Config() { Responsive = true };
	private Layout layout = new Layout
	{
		Title = new Plotly.Blazor.LayoutLib.Title { Text = "" },
		Scene = new List<Scene>
	{
			new Scene
			{
				XAxis = new Plotly.Blazor.LayoutLib.SceneLib.XAxis { Title = new Plotly.Blazor.LayoutLib.SceneLib.XAxisLib.Title { Text = "" }},
				YAxis = new Plotly.Blazor.LayoutLib.SceneLib.YAxis { Title = new Plotly.Blazor.LayoutLib.SceneLib.YAxisLib.Title { Text = "" }},
				ZAxis = new Plotly.Blazor.LayoutLib.SceneLib.ZAxis { Title = new Plotly.Blazor.LayoutLib.SceneLib.ZAxisLib.Title { Text = "" }}
			}
		}
	};

	// Using of the interface IList is important for the event callback!
	private IList<ITrace> data = new List<ITrace>();

	public async Task Plot()
	{
		//Update layout of the plot
		if (layout != null && PlotTitle != null && XAxisTitle != null && YAxisTitle != null && ZAxisTitle != null)
		{
			layout.Height = PlotHeight;
			layout.Width = PlotWidth;
			layout.Title.Text = PlotTitle;
			layout.Scene.ElementAt(0).XAxis.Title.Text = XAxisTitle;
			layout.Scene.ElementAt(0).YAxis.Title.Text = YAxisTitle;
			layout.Scene.ElementAt(0).ZAxis.Title.Text = ZAxisTitle;
			if (ZAxisIsReversed)
				layout.Scene.ElementAt(0).ZAxis.AutoRange = Plotly.Blazor.LayoutLib.SceneLib.ZAxisLib.AutoRangeEnum.Reversed;
			layout.Scene.ElementAt(0).AspectMode = Plotly.Blazor.LayoutLib.SceneLib.AspectModeEnum.Data;

			//Remove existing traces
			await chart.Clear();
			//Upate the whole chart (Relayout() only updates the layout)
			await chart.React();
		}

		//Plot 3D interpolated curve
		if (XValuesLine != null && XValuesLine.Any() && YValuesLine != null && YValuesLine.Any() && ZValuesLine != null && ZValuesLine.Any())
		{
			await chart.AddTrace(new Scatter3D
			{
				Name = ValuesNameLine,
				Mode = Plotly.Blazor.Traces.Scatter3DLib.ModeFlag.Lines,
				X = XValuesLine,
				Y = YValuesLine,
				Z = ZValuesLine
			});
		}
		//Plot 3D interpolated curve
		if (XValuesLine2 != null && XValuesLine2.Any() && YValuesLine2 != null && YValuesLine2.Any() && ZValuesLine2 != null && ZValuesLine2.Any())
		{
			await chart.AddTrace(new Scatter3D
			{
				Name = ValuesNameLine2,
				Mode = Plotly.Blazor.Traces.Scatter3DLib.ModeFlag.Lines,
				X = XValuesLine2,
				Y = YValuesLine2,
				Z = ZValuesLine2
			});
		}

		if (XValuesList == null || XValuesList.Count <= 0)
		{
			//Plot 3D surface
			if (XValues != null && XValues.Any() && YValues != null && YValues.Any() && ZValues != null && ZValues.Any())
			{
				await chart.AddTrace(new Plotly.Blazor.Traces.Mesh3D
				{
					Name = ValuesName,
					X = XValues,
					Y = YValues,
					Z = ZValues,
					AlphaHull = 5,
					Opacity = new System.Decimal(0.4)
				});
			}

			//Plot 3D surface
			if (XValuesCompare != null && XValuesCompare.Count > 0 && XValuesCompare[0].Any() && YValuesCompare != null && YValuesCompare.Count > 0 && YValuesCompare[0].Any()
				&& ZValuesCompare != null && ZValuesCompare.Count > 0 && ZValuesCompare[0].Any())
			{
				for (int i = 0; i < XValuesCompare.Count; i++)
				{
					await chart.AddTrace(new Plotly.Blazor.Traces.Mesh3D
					{
						Name = ValuesNameListCompare,
						X = XValuesCompare[i],
						Y = YValuesCompare[i],
						Z = ZValuesCompare[i],
						AlphaHull = 5,
						Color = ValuesListColorCompare[i],
						Opacity = new System.Decimal(0.4)
					});
				}
			}

			//if (XValues2 != null && XValues2.Any() && YValues2 != null && YValues2.Any() && ZValues2 != null && ZValues2.Any())
			//{
			//	await chart.AddTrace(new Plotly.Blazor.Traces.Mesh3D
			//	{
			//		Name = ValuesName2,
			//		X = XValues2,
			//		Y = YValues2,
			//		Z = ZValues2
			//	});
			//}
		}
		else
		{
			//Plot 3D surface
			if (XValuesList != null && XValuesList.Count > 0 && XValuesList[0].Any() && YValuesList != null && YValuesList.Count > 0 && YValuesList[0].Any()
				&& ZValuesList != null && ZValuesList.Count > 0 && ZValuesList[0].Any())
			{
				for (int i = 0; i < XValuesList.Count; i++)
				{
					await chart.AddTrace(new Plotly.Blazor.Traces.Mesh3D
					{
						Name = ValuesNameList,
						X = XValuesList[i],
						Y = YValuesList[i],
						Z = ZValuesList[i],
						AlphaHull = -1,
						Color = ValuesListColor,
						Opacity = new System.Decimal(0.4)
					});
				}
			}
			if (XValuesList2 != null && XValuesList2.Count > 0 && XValuesList2[0].Any() && YValuesList2 != null && YValuesList2.Count > 0 && YValuesList2[0].Any()
				&& ZValuesList2 != null && ZValuesList2.Count > 0 && ZValuesList2[0].Any())
			{
				for (int i = 0; i < XValuesList2.Count; i++)
				{
					await chart.AddTrace(new Plotly.Blazor.Traces.Mesh3D
					{
						Name = ValuesNameList2,
						X = XValuesList2[i],
						Y = YValuesList2[i],
						Z = ZValuesList2[i],
						AlphaHull = -1,
						Color = ValuesListColor2,
						Opacity = new System.Decimal(0.4)
					});
				}
			}
			if (XValuesListCompare != null && XValuesListCompare.Count > 0 && XValuesListCompare[0].Any() && YValuesListCompare != null && YValuesListCompare.Count > 0 && YValuesListCompare[0].Any()
				&& ZValuesListCompare != null && ZValuesListCompare.Count > 0 && ZValuesListCompare[0].Any())
			{
				for (int c = 0; c < XValuesListCompare.Count; c++)
				{
					for (int i = 0; i < XValuesListCompare[c].Count; i++)
					{
						await chart.AddTrace(new Plotly.Blazor.Traces.Mesh3D
						{
							Name = ValuesNameListCompare,
							X = XValuesListCompare[c][i],
							Y = YValuesListCompare[c][i],
							Z = ZValuesListCompare[c][i],
							AlphaHull = -1,
							Color = ValuesListColorCompare[c],
							Opacity = new System.Decimal(0.4)
						});
					}
				}
			}

		}

	}
}
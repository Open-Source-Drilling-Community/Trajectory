<PlotlyChart @bind-Config="config" @bind-Layout="layout" @bind-Data="data" @ref="chart" />

@code {
	[Parameter]
	public List<object> XValues { get; set; }

	[Parameter]
	public List<object> YValues { get; set; }

	[Parameter]
	public List<object> ZValues { get; set; }

	[Parameter]
	public string ValuesName { get; set; }



	[Parameter]
	public List<object> XValues2 { get; set; }

	[Parameter]
	public List<object> YValues2 { get; set; }

	[Parameter]
	public List<object> ZValues2 { get; set; }

	[Parameter]
	public string ValuesName2 { get; set; }


	[Parameter]
	public int PlotHeight { get; set; }

	[Parameter]
	public int PlotWidth { get; set; }

	[Parameter]
	public string PlotTitle { get; set; }

	[Parameter]
	public string XAxisTitle { get; set; }

	[Parameter]
	public string YAxisTitle { get; set; }

	[Parameter]
	public string ZAxisTitle { get; set; }

	[Parameter]
	public bool ZAxisIsReversed { get; set; }

	private PlotlyChart chart;
	private Config config = new Config() { Responsive = true };
	private Layout layout = new Layout
	{
		Title = new Plotly.Blazor.LayoutLib.Title { Text = "" },
		Scene = new List<Scene>
	{
			new Scene
			{
				XAxis = new Plotly.Blazor.LayoutLib.SceneLib.XAxis { Title = new Plotly.Blazor.LayoutLib.SceneLib.XAxisLib.Title { Text = "" }},
				YAxis = new Plotly.Blazor.LayoutLib.SceneLib.YAxis { Title = new Plotly.Blazor.LayoutLib.SceneLib.YAxisLib.Title { Text = "" }},
				ZAxis = new Plotly.Blazor.LayoutLib.SceneLib.ZAxis { Title = new Plotly.Blazor.LayoutLib.SceneLib.ZAxisLib.Title { Text = "" }}
			}
		}
	};

	// Using of the interface IList is important for the event callback!
	private IList<ITrace> data = new List<ITrace>();

	public async Task Plot()
	{
		//Update layout of the plot
		if (layout != null && PlotTitle != null && XAxisTitle != null && YAxisTitle != null && ZAxisTitle != null)
		{
			layout.Height = PlotHeight;
			layout.Width = PlotWidth;
			layout.Title.Text = PlotTitle;
			layout.Scene.ElementAt(0).XAxis.Title.Text = XAxisTitle;
			layout.Scene.ElementAt(0).YAxis.Title.Text = YAxisTitle;
			layout.Scene.ElementAt(0).ZAxis.Title.Text = ZAxisTitle;
			if (ZAxisIsReversed)
				layout.Scene.ElementAt(0).ZAxis.AutoRange = Plotly.Blazor.LayoutLib.SceneLib.ZAxisLib.AutoRangeEnum.Reversed;
			//Remove existing traces
			await chart.Clear();
			//Upate the whole chart (Relayout() only updates the layout)
			await chart.React();
		}

		//Plot 3D surface
		if (XValues != null && XValues.Any() && YValues != null && YValues.Any() && ZValues != null && ZValues.Any())
		{
			await chart.AddTrace(new Plotly.Blazor.Traces.Mesh3D
			{
				Name = ValuesName,
				X = XValues,
				Y = YValues,
				Z = ZValues
			});
		}

		//Plot 3D surface
		if (XValues2 != null && XValues2.Any() && YValues2 != null && YValues2.Any() && ZValues2 != null && ZValues2.Any())
		{
			await chart.AddTrace(new Plotly.Blazor.Traces.Mesh3D
			{
				Name = ValuesName2,
				X = XValues2,
				Y = YValues2,
				Z = ZValues2
			});
		}

	}
}
}
